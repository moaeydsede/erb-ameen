<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ERP PRO | لوحة التحكم</title>
  <link rel="manifest" href="pwa/manifest.json">
  <meta name="theme-color" content="#0b1220">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo-dot">ERP</div>
        <div style="min-width:0">
          <h1>ERP PRO</h1>
          <div class="badge">بطاقة تكاليف</div>
        </div>
      </div>
      <div class="actions">
        <span class="chip">مستخدم: <b id="userChip">—</b></span>
        <a class="btn sm" href="dashboard.html">الرئيسية</a>
        <button class="btn sm danger" id="logoutBtn">خروج</button>
      </div>
    </div>
    <div class="nav-groups" id="groups"></div>
  </div>

  <div class="container">
<div class="grid">
  <div class="card">
    <div class="card-header"><h2 class="card-title">بطاقة تكاليف</h2></div>
    <div class="card-body">
      <div id="msg" class="notice" style="display:none"></div>
      <div class="row">
        <div><div class="section-title">اسم البطاقة</div><input id="name" class="input" placeholder="منتج / عملية"></div>
        <div><div class="section-title">التاريخ</div><input id="date" class="input" type="date"></div>
        <div><div class="section-title">اليوم</div><div class="chip" id="day">—</div></div>
      </div>
      <div style="height:10px"></div>
      <div class="row">
        <div style="flex:1">
          <div class="section-title">تسعير المواد الأولية</div>
          <select id="priceMethod" class="input">
            <option value="last">آخر شراء</option>
            <option value="max">أعلى شراء</option>
            <option value="avg">متوسط شراء</option>
          </select>
        </div>
        <div style="flex:1">
          <div class="section-title">الإجمالي الكلي</div>
          <div class="chip">مواد: <b id="tRaw">0.00</b> | مصاريف: <b id="tExp">0.00</b> | جاهز: <b id="tFg">0.00</b> | <b id="tAll">0.00</b></div>
        </div>
      </div>

      <hr class="sep">
      <div class="section-title">1) المواد الأولية</div>
      <table class="table">
        <thead><tr><th>المادة</th><th>كمية</th><th>سعر</th><th>إجمالي</th><th></th></tr></thead>
        <tbody id="rawLines"></tbody>
      </table>
      <button class="btn sm" id="addRawBtn">+ إضافة مادة أولية</button>

      <hr class="sep">
      <div class="section-title">2) المصاريف</div>
      <table class="table">
        <thead><tr><th>بيان</th><th>المبلغ</th><th></th></tr></thead>
        <tbody id="expLines"></tbody>
      </table>
      <button class="btn sm" id="addExpBtn">+ إضافة مصروف</button>

      <hr class="sep">
      <div class="section-title">3) البضاعة الجاهزة</div>
      <div class="notice">اختر البضاعة الجاهزة وأدخل العدد فقط — سيتم توزيع إجمالي (المواد + المصاريف) على العدد تلقائياً.</div>
      <table class="table">
        <thead><tr><th>المادة الجاهزة</th><th>عدد</th><th>تكلفة/وحدة</th><th>إجمالي</th><th></th></tr></thead>
        <tbody id="fgLines"></tbody>
      </table>
      <button class="btn sm" id="addFgBtn">+ إضافة بضاعة جاهزة</button>

      <div style="height:12px"></div>
      <div class="row">
        <button id="saveBtn" class="btn primary">حفظ</button>
        <button id="resetBtn" class="btn">تفريغ</button>
        <button id="exportBtn" class="btn">تصدير Excel</button>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header"><h2 class="card-title">السجل</h2></div>
    <div class="card-body">
      <table class="table">
        <thead><tr><th>تاريخ</th><th>اسم</th><th>إجمالي</th><th>إجراء</th></tr></thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </div>
</div>

<input type="file" id="importFile" accept=".xlsx,.xls" style="display:none">
</div>

  <nav class="bottom-nav" id="bottomNav"></nav>

  <div class="overlay" id="overlay"></div>
  <div class="menu" id="menu">
    <div class="head">
      <h3 class="title" id="menuTitle">—</h3>
      <button class="btn sm iconbtn" id="menuClose" title="إغلاق">✕</button>
    </div>
    <div class="body" id="menuBody"></div>
  </div>

  <script type="module">import "./pwa/register-sw.js";</script>
  <script type="module" src="js/nav.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script type="module" src="js/cost-card.js"></script>
</body>
</html>
