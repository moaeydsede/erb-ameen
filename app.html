<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CRM Score โ ููุญุฉ ุงูุชุญูู</title>
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles/app.css" />
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div class="brand">
        <div class="badge"><img src="assets/favicon.svg" alt=""></div>
        <div>
          <div class="title">ููุญุฉ ุงูุชุญูู</div>
          <div class="sub">ุนุฑุถ ุณุฑูุน + ุจุญุซ + ุชูุงุฑูุฑ + ุทุจุงุนุฉ + CSV</div>
        </div>
      </div>
      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end">
        <div style="text-align:left">
          <div style="font-weight:900" id="meName">โ</div>
          <div class="small"><span id="meRole">โ</span> โข UID: <span id="meUid">โ</span></div>
        </div>
        <button class="btn danger" id="btnLogout">ุฎุฑูุฌ</button>
      </div>
    </div>

    <div style="height:14px"></div>

    <div class="row">
      <aside class="panel sidebar">
        <button class="navbtn" data-nav="dashboard" aria-current="true">
          <div><strong>ุงูุฑุฆูุณูุฉ</strong><div class="hint">KPIs + ุชูููู ุนุงู</div></div>
          <div>๐</div>
        </button>
        <button class="navbtn" data-nav="customers">
          <div><strong>ุงูุนููุงุก</strong><div class="hint">ุจุญุซ + ุชุนุฏูู + ุงุณุชูุฑุงุฏ/ุชุตุฏูุฑ</div></div>
          <div>๐ฅ</div>
        </button>
        <button class="navbtn" data-nav="ratios">
          <div><strong>ุงูููุณุจ</strong><div class="hint">ุฃุฒุฑุงุฑ ุชูุงุฑูุฑ ูุณุจ</div></div>
          <div>๐</div>
        </button>
        <button class="navbtn" data-nav="users">
          <div><strong>ุงููุณุชุฎุฏููู</strong><div class="hint">ููุฃุฏูู ููุท</div></div>
          <div>๐</div>
        </button>
        <div class="hr"></div>
        <div class="small">
          โ ูุตูุญุฉ: ุงุณุชุฎุฏู CSV ููุงุณุชูุฑุงุฏ ุงูุณุฑูุน.<br>
          โ ููุทุจุงุนุฉ: ุฒุฑ โุทุจุงุนุฉโ.<br>
          โ๏ธ ุงููุณุฎุฉ ุชุนุชูุฏ ุนูู Firebase Firestore.
        </div>
      </aside>

      <main class="panel main">
        <!-- DASHBOARD -->
        <section data-view="dashboard">
          <h2 style="margin:0 0 10px 0">ููุฎุต ุงูุฃุฏุงุก</h2>
          <div class="grid">
            <div class="card"><h3>ุฅุฌูุงูู ุงููุจูุนุงุช</h3><div class="kpi"><span id="kpiSales">0</span> <small>ุฌ.ู</small></div></div>
            <div class="card"><h3>ุฅุฌูุงูู ุงููุฑุชุฌุนุงุช</h3><div class="kpi"><span id="kpiReturns">0</span> <small>ุฌ.ู</small></div></div>
            <div class="card"><h3>ุฅุฌูุงูู ุงูุณุฏุงุฏ</h3><div class="kpi"><span id="kpiPayments">0</span> <small>ุฌ.ู</small></div></div>
            <div class="card"><h3>ุฅุฌูุงูู ุงูุฎุตููุงุช</h3><div class="kpi"><span id="kpiDiscounts">0</span> <small>ุฌ.ู</small></div></div>
            <div class="card"><h3>ุนุฏุฏ ุงูุนููุงุก</h3><div class="kpi" id="kpiCustomers">0</div></div>
            <div class="card"><h3>ูุชูุณุท ุงูุชูููู</h3><div class="kpi"><span id="kpiStars">0.0</span> <small>/ 5</small></div></div>
          </div>

          <div class="hr"></div>

          <div class="toolbar">
            <button class="btn" onclick="location.hash='#customers';">ูุชุญ ุงูุนููุงุก</button>
            <button class="btn secondary" id="btnPrint">ุทุจุงุนุฉ</button>
          </div>
        </section>

        <!-- CUSTOMERS -->
        <section data-view="customers" style="display:none">
          <h2 style="margin:0 0 10px 0">ุงูุนููุงุก</h2>
          <div class="toolbar">
            <input class="input" id="search" placeholder="ุจุญุซ ุจุงูุงุณู ุฃู ุงูููุฏ (ูุนูู ุญุชู ูู ุงููููุฉ ูู ุขุฎุฑ ุงูุงุณู)" />
            <button class="btn" id="btnAddCustomer">ุฅุถุงูุฉ ุนููู</button>
            <button class="btn secondary" id="btnExport">ุชุตุฏูุฑ CSV</button>
            <label class="btn secondary" style="display:inline-flex; align-items:center; gap:8px">
              ุงุณุชูุฑุงุฏ CSV
              <input id="csvFile" type="file" accept=".csv" style="display:none">
            </label>
          </div>
          <div class="small">ุนุฏุฏ ุงูุนููุงุก: <b id="customersCount">0</b></div>

          <div style="height:10px"></div>
          <table class="table">
            <thead>
              <tr>
                <th>ุงูุนููู</th>
                <th>ูุจูุนุงุช</th>
                <th>ูุฑุชุฌุนุงุช</th>
                <th>ุณุฏุงุฏ</th>
                <th>ุฎุตููุงุช</th>
                <th>ุชูููู</th>
                <th>ุชูุงุตูู</th>
              </tr>
            </thead>
            <tbody id="customersTbody"></tbody>
          </table>
        </section>

        <!-- RATIOS -->
        <section data-view="ratios" style="display:none">
          <h2 style="margin:0 0 10px 0">ุชูุงุฑูุฑ ุงูููุณุจ</h2>
          <div class="grid">
            <div class="card" style="grid-column: span 6">
              <h3>ููุณุจ ุญุณุจ ุงููุจูุนุงุช / ุงููุฑุชุฌุนุงุช</h3>
              <div class="toolbar">
                <button class="btn secondary" onclick="alert('ูุฐุง ูููุฐุฌ ุฌุงูุฒ. ูููู ุฑุจุทู ุจุชูุฑูุฑ ูุนูู ุญุณุจ ุงุญุชูุงุฌู.')">ูุณุจุฉ ุงููุฑุชุฌุนุงุช</button>
                <button class="btn secondary" onclick="alert('ูุฐุง ูููุฐุฌ ุฌุงูุฒ. ูููู ุฑุจุทู ุจุชูุฑูุฑ ูุนูู ุญุณุจ ุงุญุชูุงุฌู.')">ูุณุจุฉ ุงูุณุฏุงุฏ</button>
                <button class="btn secondary" onclick="alert('ูุฐุง ูููุฐุฌ ุฌุงูุฒ. ูููู ุฑุจุทู ุจุชูุฑูุฑ ูุนูู ุญุณุจ ุงุญุชูุงุฌู.')">ูุณุจุฉ ุงูุฎุตููุงุช</button>
              </div>
              <div class="small">ููุงุญุธุฉ: ูุฐู ุงูุฃุฒุฑุงุฑ ุฌุงูุฒุฉ โ ูููู ุชูุนูู ุญุณุงุจ ุงูููุณุจ ุจุฏูุฉ ุญุณุจ ูุนุงุฏูุงุชู.</div>
            </div>
            <div class="card" style="grid-column: span 6">
              <h3>ุทุจุงุนุฉ / ุชุตุฏูุฑ</h3>
              <div class="toolbar">
                <button class="btn" onclick="window.print()">ุทุจุงุนุฉ ูุฐู ุงูุตูุญุฉ</button>
                <button class="btn secondary" onclick="alert('ุชุตุฏูุฑ Excel ูุญุชุงุฌ ููุชุจุฉ SheetJS. ุฅู ุฑุบุจุช ุฃุถูููุง ูู.')">ุชุตุฏูุฑ Excel (ุงุฎุชูุงุฑู)</button>
              </div>
              <div class="small">ุงูุทุจุงุนุฉ ุชุนูู ูุจุงุดุฑุฉ ูู ุงููุชุตูุญ ุนูู A4.</div>
            </div>
          </div>
        </section>

        <!-- USERS (Admin) -->
        <section data-view="users" style="display:none">
          <h2 style="margin:0 0 10px 0">ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู (Admin)</h2>
          <div class="card" style="grid-column: span 12">
            <h3>ููุงุญุธุฉ ูููุฉ</h3>
            <div class="small">
              ุฅูุดุงุก ูุณุชุฎุฏููู ุฏุงุฎู Firebase Authentication ูุญุชุงุฌ ุฅููุง:
              <br>1) Firebase Admin SDK ุนูู ุณูุฑูุฑ/Cloud Function
              <br>ุฃู 2) ุฅูุดุงุก ุงููุณุชุฎุฏู ูู ููุญุฉ Firebase ุซู ุชูุนูู ุตูุงุญูุงุชู ูู Firestore.
              <br><br>
              โ ุงูุญู ุงููุฌุงูู ุงูุฃุณูู: ุฃูุดุฆ ุงููุณุชุฎุฏู ูู Authentication ุซู ุฃุถู ูุซููุชู ุฏุงุฎู:
              <br><b>tenants/Main/users/&lt;uid&gt;</b> ูุน <b>role</b> ู <b>active</b>.
            </div>
          </div>
        </section>

      </main>
    </div>
  </div>

  <dialog id="modal" style="border:1px solid rgba(255,255,255,.10); border-radius:16px; background:rgba(15,26,47,.98); color:#e8eefc; padding:16px; width:min(520px, 95vw)">
    <h3 style="margin:0 0 10px 0" id="modalName">ุนููู</h3>
    <div class="toolbar">
      <input class="input" id="mSales" type="number" step="0.01" placeholder="ุงููุจูุนุงุช" />
      <input class="input" id="mReturns" type="number" step="0.01" placeholder="ุงููุฑุชุฌุนุงุช" />
      <input class="input" id="mPayments" type="number" step="0.01" placeholder="ุงูุณุฏุงุฏ" />
      <input class="input" id="mDiscounts" type="number" step="0.01" placeholder="ุงูุฎุตููุงุช" />
      <input class="input" id="mStars" type="number" step="0.1" min="0" max="5" placeholder="ุงูุชูููู (0-5)" />
    </div>
    <div class="toolbar" style="justify-content:flex-end">
      <button class="btn secondary" id="btnCloseModal">ุฅุบูุงู</button>
      <button class="btn" id="btnSaveCustomer">ุญูุธ</button>
    </div>
  </dialog>

  <div id="toast" class="toast" aria-live="polite">
    <div class="t" id="toastTitle"></div>
    <div class="m" id="toastMsg"></div>
  </div>

  <script type="module" src="js/app.js"></script>
  <script>
    // hash navigation shortcut
    if(location.hash === "#customers"){
      // app.js handles view switching; this is just UX.
    }
    if("serviceWorker" in navigator){
      navigator.serviceWorker.register("./service-worker.js").catch(()=>{});
    }
  </script>
</body>
</html>
